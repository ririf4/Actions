name: GitHub to Discord Webhook

on:
  workflow_dispatch:
    inputs:
      repo_name:
        description: "Repository name"
        required: true
        type: string
      branch_name:
        description: "Branch name"
        required: true
        type: string
      event_type:
        description: "Event type (commit, pull-request, issues)"
        required: true
        type: string
      commit_sha:
        description: "Commit SHA"
        required: false
        type: string
      commit_message:
        description: "Commit message"
        required: false
        type: string
      commit_author:
        description: "Commit author"
        required: false
        type: string
      pr_title:
        description: "Pull request title"
        required: false
        type: string
      pr_body:
        description: "Pull request body"
        required: false
        type: string
      pr_url:
        description: "Pull request URL"
        required: false
        type: string
      pr_number:
        description: "Pull request number"
        required: false
        type: string
      pr_author:
        description: "Pull request author"
        required: false
        type: string
      pr_state:
        description: "Pull request state"
        required: false
        type: string
      pr_merged:
        description: "Pull request merged status"
        required: false
        type: boolean
      issue_title:
        description: "Issue title"
        required: false
        type: string
      issue_body:
        description: "Issue body"
        required: false
        type: string
      issue_url:
        description: "Issue URL"
        required: false
        type: string
      issue_number:
        description: "Issue number"
        required: false
        type: string
      issue_author:
        description: "Issue author"
        required: false
        type: string
      issue_state:
        description: "Issue state"
        required: false
        type: string

jobs:
  send_webhook:
    runs-on: ubuntu-22.04

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Set up JDK 21
        uses: actions/setup-java@v4
        with:
          distribution: 'microsoft'
          java-version: 21

      - name: Grant execute permissions to gradlew
        run: chmod +x gradlew

      - name: Execute Kotlin Webhook
        env:
          DISCORD_COMMIT_WEBHOOK: ${{ secrets.DISCORD_COMMIT_WEBHOOK }}
          DISCORD_PR_WEBHOOK: ${{ secrets.DISCORD_PR_WEBHOOK }}
          DISCORD_ISSUE_WEBHOOK: ${{ secrets.DISCORD_ISSUE_WEBHOOK }}
          GITHUB_REPOSITORY: ${{ inputs.repo_name }}
          GITHUB_REF: ${{ inputs.branch_name }}
          GITHUB_SHA: ${{ inputs.commit_sha }}
          GITHUB_EVENT_HEAD_COMMIT_MESSAGE: ${{ inputs.commit_message }}
          GITHUB_ACTOR: ${{ inputs.commit_author || inputs.pr_author || inputs.issue_author }}
          GITHUB_PR_TITLE: ${{ inputs.pr_title }}
          GITHUB_PR_BODY: ${{ inputs.pr_body }}
          GITHUB_PR_URL: ${{ inputs.pr_url }}
          GITHUB_PR_NUMBER: ${{ inputs.pr_number }}
          GITHUB_PR_AUTHOR: ${{ inputs.pr_author }}
          GITHUB_PR_STATE: ${{ inputs.pr_state }}
          GITHUB_PR_MERGED: ${{ inputs.pr_merged }}
          GITHUB_EVENT_TYPE: ${{ inputs.event_type }}
          GITHUB_ISSUE_TITLE: ${{ inputs.issue_title }}
          GITHUB_ISSUE_BODY: ${{ inputs.issue_body }}
          GITHUB_ISSUE_URL: ${{ inputs.issue_url }}
          GITHUB_ISSUE_NUMBER: ${{ inputs.issue_number }}
          GITHUB_ISSUE_AUTHOR: ${{ inputs.issue_author }}
          GITHUB_ISSUE_STATE: ${{ inputs.issue_state }}

        run: ./gradlew run --args="-${{ inputs.event_type }}"
